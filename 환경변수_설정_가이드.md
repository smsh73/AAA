# 환경변수 설정 가이드

## 프론트엔드 API URL 설정

### 문제 상황

프론트엔드에서 백엔드 API를 호출할 때 다음과 같은 오류가 발생할 수 있습니다:

```
API Request Error: No response received
Network Error
baseURL: "http://localhost:8000"
```

### 원인

- `NEXT_PUBLIC_API_URL` 환경변수가 설정되지 않아 fallback으로 `http://localhost:8000` 사용
- 브라우저에서 직접 다른 포트로 요청 시 CORS 문제 발생

### 해결 방법

#### 방법 1: 상대 경로 사용 (권장)

**개발 환경** (`apps/web/.env.local`):
```bash
# 빈 문자열로 설정 - Next.js rewrites를 통한 프록시 사용
NEXT_PUBLIC_API_URL=

# 서버 사이드에서 사용할 백엔드 URL
API_URL=http://localhost:8000
```

**장점**:
- CORS 문제 없음
- Next.js가 자동으로 `/api/*` 요청을 백엔드로 프록시
- 개발 환경에서 가장 간단한 설정

**동작 방식**:
1. 프론트엔드에서 `api.get('/api/analysts')` 호출
2. Next.js rewrites가 `/api/analysts`를 `http://localhost:8000/api/analysts`로 프록시
3. 서버 사이드에서 프록시되므로 CORS 문제 없음

#### 방법 2: 직접 URL 지정

**개발 환경** (`apps/web/.env.local`):
```bash
NEXT_PUBLIC_API_URL=http://localhost:8000
```

**주의사항**:
- 백엔드에서 CORS 설정이 필요합니다
- `CORS_ORIGINS` 환경변수에 `http://localhost:3000` 추가 필요

**프로덕션 환경** (`apps/web/.env.production`):
```bash
NEXT_PUBLIC_API_URL=https://api.yourdomain.com
```

## 환경변수 파일 생성

### 개발 환경

```bash
cd apps/web
cat > .env.local << EOF
# API URL 설정 (빈 문자열 권장)
NEXT_PUBLIC_API_URL=

# 서버 사이드 프록시용 백엔드 URL
API_URL=http://localhost:8000
EOF
```

### 프로덕션 환경

```bash
cd apps/web
cat > .env.production << EOF
# 프로덕션 API URL
NEXT_PUBLIC_API_URL=https://api.yourdomain.com
EOF
```

## Next.js 환경변수 규칙

1. **클라이언트 사이드 접근**: `NEXT_PUBLIC_` 접두사 필요
   - `NEXT_PUBLIC_API_URL` ✅
   - `API_URL` ❌ (서버 사이드에서만 접근 가능)

2. **서버 사이드 접근**: 모든 환경변수 접근 가능
   - `process.env.API_URL` ✅
   - `process.env.NEXT_PUBLIC_API_URL` ✅

3. **환경변수 변경 후**: Next.js 개발 서버 재시작 필요
   ```bash
   # 환경변수 변경 후
   npm run dev
   ```

## 확인 방법

1. **브라우저 콘솔 확인**:
   ```javascript
   console.log(process.env.NEXT_PUBLIC_API_URL)
   // 빈 문자열이거나 설정된 URL이 출력되어야 함
   ```

2. **Network 탭 확인**:
   - 상대 경로 사용 시: `/api/analysts`
   - 직접 URL 사용 시: `http://localhost:8000/api/analysts`

3. **에러 확인**:
   - CORS 오류가 없어야 함
   - Network Error가 발생하지 않아야 함

## 백엔드 CORS 설정 (방법 2 사용 시)

백엔드 `.env` 또는 `docker-compose.yml`:
```bash
CORS_ORIGINS=http://localhost:3000,https://yourdomain.com
```

또는 `docker-compose.yml`:
```yaml
services:
  api:
    environment:
      CORS_ORIGINS: ${CORS_ORIGINS:-http://localhost:3000}
```
