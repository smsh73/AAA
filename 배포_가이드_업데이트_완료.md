# 배포 가이드 및 마이그레이션 가이드 업데이트 완료

## 업데이트 내용

### 배포 가이드 (`배포_가이드.md`)

#### 1. 환경 변수 업데이트
- **신규 추가**: `DART_API_KEY` (OpenDART API 키)
- **선택사항 명시**: `REDIS_URL` (BackgroundTasks 사용 시 불필요)
- **API 키 목록 확장**: Anthropic, Google, DART 추가

#### 2. BackgroundTasks 관련 내용 추가
- FastAPI BackgroundTasks 사용 설명
- Celery/Redis 의존성 제거 설명
- 배포 단순화 효과 설명

#### 3. PDF 일괄 업로드 섹션 추가
- `apps/api/scripts/batch_upload_pdfs.py` 스크립트 사용법
- PDF 파일 위치 및 기능 설명

#### 4. 체크리스트 업데이트
- OpenDART API 키 발급 및 설정 추가
- Redis 연결 확인을 선택사항으로 변경
- 평가 프로세스 테스트 추가
- 에이전트 콘솔 동작 확인 추가

#### 5. 주요 변경사항 섹션 추가
- BackgroundTasks 도입
- Enum 정의 추가
- 외부 API 통합
- PDF 일괄 업로드
- 테스트 추가

### 마이그레이션 가이드 (`apps/api/전체_마이그레이션_가이드.md`)

#### 1. 최신 변경사항 섹션 추가
- BackgroundTasks 도입
- Enum 정의 추가
- 외부 API 통합
- PDF 일괄 업로드
- 테스트 추가

#### 2. 마이그레이션 버전 정보 상세화
- 001_initial_migration: 18개 테이블 목록 추가
- 002_add_collection_job: 상세 설명 추가

### 마이그레이션 실행 가이드 (`apps/api/마이그레이션_실행_가이드.md`)

#### 1. 최신 변경사항 섹션 추가
- BackgroundTasks 도입
- Enum 정의 추가
- 외부 API 통합
- PDF 일괄 업로드

#### 2. 마이그레이션 버전 정보 추가
- 001_initial_migration: 초기 테이블 생성 (18개 테이블)
- 002_add_collection_job: 데이터 수집 작업 테이블 추가

#### 3. 주요 변경사항 섹션 추가
- BackgroundTasks 사용 설명
- Enum 정의 설명
- 외부 API 통합 설명

## 주요 변경사항 요약

### 1. BackgroundTasks 도입
- **이전**: Celery/Redis 필수
- **현재**: FastAPI BackgroundTasks 우선 사용, Celery/Redis 선택사항
- **효과**: 배포 단순화, 세션 충돌 방지

### 2. Enum 정의 추가
- `EvaluationStatus`: 평가 상태 관리
- `ReportStatus`: 리포트 상태 관리
- `CollectionJobStatus`: 데이터 수집 작업 상태 관리

### 3. 외부 API 통합
- **OpenDART API**: 기업 실적 데이터 수집 (`DART_API_KEY` 필요)
- **KRX API**: 주가 데이터 수집 (API 키 불필요)

### 4. PDF 일괄 업로드
- `apps/api/scripts/batch_upload_pdfs.py` 스크립트 추가
- PDF 파일 자동 스캔 및 업로드
- 애널리스트 및 기업 자동 매칭/생성

### 5. 테스트 추가
- `apps/api/tests/test_evaluation_agent.py`: 유닛 테스트
- `apps/api/tests/test_integration.py`: 통합 테스트

## 환경 변수 변경사항

### 신규 추가
- `DART_API_KEY`: OpenDART API 키 (기업 실적 데이터 수집용)

### 선택사항 명시
- `REDIS_URL`: BackgroundTasks 사용 시 불필요

## Docker Compose 업데이트

`docker-compose.yml`에 `DART_API_KEY` 환경변수 추가:

```yaml
environment:
  DART_API_KEY: ${DART_API_KEY}
```

## 업데이트 완료

모든 문서가 현재 소스코드 기준으로 업데이트되었습니다.

