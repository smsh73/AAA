# ë°°í¬ ê°€ì´ë“œ

## ê°œìš”

ì´ ê°€ì´ë“œëŠ” AIê°€ ì°¾ì€ ìŠ¤íƒ€ ì• ë„ë¦¬ìŠ¤íŠ¸ ì–´ì›Œì¦ˆ ì‹œìŠ¤í…œì˜ ë°°í¬ë¥¼ ìœ„í•œ í¬ê´„ì ì¸ ê°€ì´ë“œì…ë‹ˆë‹¤.

## 1. í¬íŠ¸ êµ¬ì„± ì •í•©ì„± ê²€í† 

### 1.1 ê°œë°œ í™˜ê²½ í¬íŠ¸ êµ¬ì„±

| ì„œë¹„ìŠ¤ | í¬íŠ¸ | í™˜ê²½ë³€ìˆ˜ | ë¹„ê³  |
|--------|------|----------|------|
| í”„ë¡ íŠ¸ì—”ë“œ (Next.js) | 3000 | ê¸°ë³¸ê°’ | `npm run dev` |
| ë°±ì—”ë“œ (FastAPI) | 8000 | ê¸°ë³¸ê°’ | `uvicorn app.main:app --port 8000` |
| PostgreSQL | 5432 | `DATABASE_URL` | Docker Compose |
| Redis | 6379 | `REDIS_URL` | Docker Compose |

### 1.2 í”„ë¡œë•ì…˜ í™˜ê²½ í¬íŠ¸ êµ¬ì„±

í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ(Nginx, Traefik ë“±)ë¥¼ ì‚¬ìš©í•˜ì—¬ í¬íŠ¸ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.

**ê¶Œì¥ êµ¬ì„±**:
- í”„ë¡ íŠ¸ì—”ë“œ: 80/443 (HTTP/HTTPS)
- ë°±ì—”ë“œ: ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ (ì™¸ë¶€ ë…¸ì¶œ ë¶ˆí•„ìš”)
- PostgreSQL: ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬
- Redis: ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬

### 1.3 í™˜ê²½ë³€ìˆ˜ í¬íŠ¸ ì„¤ì •

**í”„ë¡ íŠ¸ì—”ë“œ** (`apps/web/.env.production`):
```bash
NEXT_PUBLIC_API_URL=https://api.yourdomain.com
```

**ë°±ì—”ë“œ** (`.env` ë˜ëŠ” í™˜ê²½ë³€ìˆ˜):
```bash
# í¬íŠ¸ëŠ” uvicorn ì‹¤í–‰ ì‹œ ì§€ì •í•˜ê±°ë‚˜ í™˜ê²½ë³€ìˆ˜ë¡œ ì„¤ì •
PORT=8000

# ë˜ëŠ” uvicorn ì‹¤í–‰ ì‹œ
uvicorn app.main:app --host 0.0.0.0 --port ${PORT:-8000}
```

**Docker Compose** (`docker-compose.yml`):
```yaml
services:
  api:
    ports:
      - "${API_PORT:-8000}:8000"
  postgres:
    ports:
      - "${POSTGRES_PORT:-5432}:5432"
  redis:
    ports:
      - "${REDIS_PORT:-6379}:6379"
```

### 1.4 CORS ì„¤ì •

ë°±ì—”ë“œì—ì„œ í”„ë¡ íŠ¸ì—”ë“œ ë„ë©”ì¸ì„ í—ˆìš©í•˜ë„ë¡ ì„¤ì •:

```bash
CORS_ORIGINS=https://yourdomain.com,https://www.yourdomain.com
```

ë˜ëŠ” `docker-compose.yml`:
```yaml
services:
  api:
    environment:
      CORS_ORIGINS: ${CORS_ORIGINS:-http://localhost:3000}
```

## 2. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜

### 2.1 ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰

#### Docker Compose ì‚¬ìš© ì‹œ

```bash
# ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
docker-compose exec api alembic upgrade head

# ë˜ëŠ” ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ
docker-compose exec api bash
cd /app
alembic upgrade head
```

#### ë¡œì»¬ ì‹¤í–‰ ì‹œ

```bash
cd apps/api
alembic upgrade head
```

### 2.2 ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒíƒœ í™•ì¸

```bash
# í˜„ì¬ ë§ˆì´ê·¸ë ˆì´ì…˜ ë²„ì „ í™•ì¸
alembic current

# ë§ˆì´ê·¸ë ˆì´ì…˜ íˆìŠ¤í† ë¦¬ í™•ì¸
alembic history

# ë‹¤ìŒ ë§ˆì´ê·¸ë ˆì´ì…˜ í™•ì¸
alembic show head
```

### 2.3 ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡¤ë°±

```bash
# ì´ì „ ë²„ì „ìœ¼ë¡œ ë¡¤ë°±
alembic downgrade -1

# íŠ¹ì • ë²„ì „ìœ¼ë¡œ ë¡¤ë°±
alembic downgrade <revision>
```

### 2.4 ìƒˆ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±

```bash
# ìë™ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
alembic revision --autogenerate -m "ì„¤ëª…"

# ìˆ˜ë™ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
alembic revision -m "ì„¤ëª…"
```

### 2.5 ì´ˆê¸° ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •

```bash
# ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” (ì£¼ì˜: ê¸°ì¡´ ë°ì´í„° ì‚­ì œë¨)
cd apps/api
python scripts/init_db.py
```

## 3. ìƒ˜í”Œ ë°ì´í„° ìƒì„±

### 3.1 ìƒ˜í”Œ ë°ì´í„° ìƒì„± ìŠ¤í¬ë¦½íŠ¸

`apps/api/scripts/generate_sample_data.py` íŒŒì¼ì„ ìƒì„±:

```python
"""
ìƒ˜í”Œ ë°ì´í„° ìƒì„± ìŠ¤í¬ë¦½íŠ¸
"""
import sys
from pathlib import Path

# í”„ë¡œì íŠ¸ ë£¨íŠ¸ë¥¼ Python ê²½ë¡œì— ì¶”ê°€
sys.path.insert(0, str(Path(__file__).parent.parent.parent))

from sqlalchemy.orm import Session
from app.database import SessionLocal
from app.models.analyst import Analyst
from app.models.company import Company
from app.models.report import Report
from app.models.evaluation import Evaluation
from app.models.scorecard import Scorecard
from app.models.award import Award
from uuid import uuid4
from datetime import datetime, date, timedelta
from decimal import Decimal

def create_sample_data():
    db: Session = SessionLocal()
    
    try:
        # ìƒ˜í”Œ ì• ë„ë¦¬ìŠ¤íŠ¸ ìƒì„±
        analysts = []
        firms = ["ì‚¼ì„±ì¦ê¶Œ", "KBì¦ê¶Œ", "ë¯¸ë˜ì—ì…‹ì¦ê¶Œ", "NHíˆ¬ìì¦ê¶Œ", "í•œêµ­íˆ¬ìì¦ê¶Œ"]
        sectors = ["ë°˜ë„ì²´", "ìë™ì°¨", "ë°©ì‚°", "ê¸ˆìœµ", "ë°”ì´ì˜¤"]
        
        for i in range(10):
            analyst = Analyst(
                id=uuid4(),
                name=f"ì• ë„ë¦¬ìŠ¤íŠ¸ {i+1}",
                firm=firms[i % len(firms)],
                department="ë¦¬ì„œì¹˜ì„¼í„°",
                sector=sectors[i % len(sectors)],
                experience_years=5 + (i % 10),
                email=f"analyst{i+1}@example.com"
            )
            db.add(analyst)
            analysts.append(analyst)
        
        db.commit()
        print(f"âœ… {len(analysts)}ëª…ì˜ ì• ë„ë¦¬ìŠ¤íŠ¸ ìƒì„± ì™„ë£Œ")
        
        # ìƒ˜í”Œ ê¸°ì—… ìƒì„±
        companies = []
        company_names = [
            ("ì‚¼ì„±ì „ì", "005930"),
            ("SKí•˜ì´ë‹‰ìŠ¤", "000660"),
            ("í˜„ëŒ€ìë™ì°¨", "005380"),
            ("LGì „ì", "066570"),
            ("NAVER", "035420")
        ]
        
        for name_kr, ticker in company_names:
            company = Company(
                id=uuid4(),
                ticker=ticker,
                name_kr=name_kr,
                name_en=name_kr,
                sector="IT",
                market_cap=Decimal("1000000000000")
            )
            db.add(company)
            companies.append(company)
        
        db.commit()
        print(f"âœ… {len(companies)}ê°œì˜ ê¸°ì—… ìƒì„± ì™„ë£Œ")
        
        # ìƒ˜í”Œ ë¦¬í¬íŠ¸ ìƒì„±
        reports = []
        for i in range(20):
            report = Report(
                id=uuid4(),
                analyst_id=analysts[i % len(analysts)].id,
                company_id=companies[i % len(companies)].id if i % 2 == 0 else None,
                title=f"ë¦¬í¬íŠ¸ ì œëª© {i+1}",
                publication_date=date.today() - timedelta(days=i),
                status="completed"
            )
            db.add(report)
            reports.append(report)
        
        db.commit()
        print(f"âœ… {len(reports)}ê°œì˜ ë¦¬í¬íŠ¸ ìƒì„± ì™„ë£Œ")
        
        # ìƒ˜í”Œ í‰ê°€ ìƒì„±
        evaluations = []
        for i, report in enumerate(reports[:10]):
            evaluation = Evaluation(
                id=uuid4(),
                report_id=report.id,
                analyst_id=report.analyst_id,
                company_id=report.company_id,
                evaluation_period=f"2025-Q{(i % 4) + 1}",
                evaluation_date=date.today() - timedelta(days=i),
                final_score=Decimal("75.5") + Decimal(str(i)),
                status="completed"
            )
            db.add(evaluation)
            evaluations.append(evaluation)
        
        db.commit()
        print(f"âœ… {len(evaluations)}ê°œì˜ í‰ê°€ ìƒì„± ì™„ë£Œ")
        
        # ìƒ˜í”Œ ìŠ¤ì½”ì–´ì¹´ë“œ ìƒì„±
        scorecards = []
        for i, evaluation in enumerate(evaluations):
            scorecard = Scorecard(
                id=uuid4(),
                analyst_id=evaluation.analyst_id,
                company_id=evaluation.company_id,
                period=evaluation.evaluation_period,
                final_score=evaluation.final_score,
                ranking=i+1,
                scorecard_data={
                    "evaluation_id": str(evaluation.id),
                    "scores": {
                        "accuracy": 80.0 + i,
                        "timeliness": 75.0 + i,
                        "coverage": 70.0 + i
                    }
                }
            )
            db.add(scorecard)
            scorecards.append(scorecard)
        
        db.commit()
        print(f"âœ… {len(scorecards)}ê°œì˜ ìŠ¤ì½”ì–´ì¹´ë“œ ìƒì„± ì™„ë£Œ")
        
        # ìƒ˜í”Œ ì–´ì›Œë“œ ìƒì„±
        awards = []
        award_types = ["gold", "silver", "bronze"]
        categories = ["ë°˜ë„ì²´", "ìë™ì°¨", "ë°©ì‚°", "ê¸ˆìœµ", "ë°”ì´ì˜¤"]
        
        for i in range(15):
            award = Award(
                id=uuid4(),
                analyst_id=analysts[i % len(analysts)].id,
                award_type=award_types[i % len(award_types)],
                award_category=categories[i % len(categories)],
                period="2025-Q1",
                rank=i+1
            )
            db.add(award)
            awards.append(award)
        
        db.commit()
        print(f"âœ… {len(awards)}ê°œì˜ ì–´ì›Œë“œ ìƒì„± ì™„ë£Œ")
        
        print("\nğŸ‰ ìƒ˜í”Œ ë°ì´í„° ìƒì„± ì™„ë£Œ!")
        print(f"  - ì• ë„ë¦¬ìŠ¤íŠ¸: {len(analysts)}ëª…")
        print(f"  - ê¸°ì—…: {len(companies)}ê°œ")
        print(f"  - ë¦¬í¬íŠ¸: {len(reports)}ê°œ")
        print(f"  - í‰ê°€: {len(evaluations)}ê°œ")
        print(f"  - ìŠ¤ì½”ì–´ì¹´ë“œ: {len(scorecards)}ê°œ")
        print(f"  - ì–´ì›Œë“œ: {len(awards)}ê°œ")
        
    except Exception as e:
        db.rollback()
        print(f"âŒ ì˜¤ë¥˜ ë°œìƒ: {e}")
        raise
    finally:
        db.close()

if __name__ == "__main__":
    create_sample_data()
```

### 3.2 ìƒ˜í”Œ ë°ì´í„° ìƒì„± ì‹¤í–‰

```bash
# ë¡œì»¬ ì‹¤í–‰
cd apps/api
python scripts/generate_sample_data.py

# Docker Compose ì‚¬ìš© ì‹œ
docker-compose exec api python scripts/generate_sample_data.py
```

## 4. ë°°í¬ ë‹¨ê³„ë³„ ê°€ì´ë“œ

### 4.1 ê°œë°œ í™˜ê²½ ë°°í¬

#### 1ë‹¨ê³„: í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

```bash
# í”„ë¡ íŠ¸ì—”ë“œ
cd apps/web
cp .env.example .env.local
# .env.local íŒŒì¼ í¸ì§‘

# ë°±ì—”ë“œ
cp .env.example .env
# .env íŒŒì¼ í¸ì§‘
```

#### 2ë‹¨ê³„: ì˜ì¡´ì„± ì„¤ì¹˜

```bash
# í”„ë¡ íŠ¸ì—”ë“œ
cd apps/web
npm install

# ë°±ì—”ë“œ
cd apps/api
pip install -r requirements.txt
```

#### 3ë‹¨ê³„: ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜

```bash
cd apps/api
alembic upgrade head
```

#### 4ë‹¨ê³„: ì„œë¹„ìŠ¤ ì‹œì‘

```bash
# Docker Compose ì‚¬ìš©
docker-compose up -d

# ë˜ëŠ” ê°œë³„ ì‹¤í–‰
# í„°ë¯¸ë„ 1: ë°±ì—”ë“œ
cd apps/api
uvicorn app.main:app --reload --port 8000

# í„°ë¯¸ë„ 2: Celery Worker
cd apps/api
celery -A app.celery_app worker --loglevel=info

# í„°ë¯¸ë„ 3: í”„ë¡ íŠ¸ì—”ë“œ
cd apps/web
npm run dev
```

### 4.2 í”„ë¡œë•ì…˜ í™˜ê²½ ë°°í¬

#### 1ë‹¨ê³„: ë¹Œë“œ

```bash
# í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ
cd apps/web
npm run build

# ë°±ì—”ë“œëŠ” ëŸ°íƒ€ì„ì— ì‹¤í–‰ë˜ë¯€ë¡œ ë¹Œë“œ ë¶ˆí•„ìš”
```

#### 2ë‹¨ê³„: í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

í”„ë¡œë•ì…˜ í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤ (í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬ ë„êµ¬ ì‚¬ìš© ê¶Œì¥).

#### 3ë‹¨ê³„: ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜

```bash
# í”„ë¡œë•ì…˜ ë°ì´í„°ë² ì´ìŠ¤ì— ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
cd apps/api
alembic upgrade head
```

#### 4ë‹¨ê³„: ì„œë¹„ìŠ¤ ì‹œì‘

```bash
# Docker Compose ì‚¬ìš©
docker-compose -f docker-compose.prod.yml up -d

# ë˜ëŠ” PM2, systemd ë“±ìœ¼ë¡œ ê´€ë¦¬
```

## 5. ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 5.1 ì‚¬ì „ ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ì™„ë£Œ
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸
- [ ] Redis ì—°ê²° í™•ì¸
- [ ] API í‚¤ ì„¤ì • í™•ì¸
- [ ] CORS ì„¤ì • í™•ì¸
- [ ] í¬íŠ¸ ì¶©ëŒ í™•ì¸

### 5.2 ë°°í¬ ì¤‘ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
- [ ] ë°±ì—”ë“œ ì„œë²„ ì‹œì‘
- [ ] Celery Worker ì‹œì‘
- [ ] í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ
- [ ] í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ ì‹œì‘

### 5.3 ë°°í¬ í›„ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Health Check API ì‘ë‹µ í™•ì¸
- [ ] í”„ë¡ íŠ¸ì—”ë“œ í˜ì´ì§€ ë¡œë“œ í™•ì¸
- [ ] API ì—”ë“œí¬ì¸íŠ¸ ë™ì‘ í™•ì¸
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸
- [ ] ë¡œê·¸ í™•ì¸
- [ ] ìƒ˜í”Œ ë°ì´í„° ìƒì„± (ì„ íƒ)

## 6. ë¬¸ì œ í•´ê²°

### 6.1 í¬íŠ¸ ì¶©ëŒ

```bash
# í¬íŠ¸ ì‚¬ìš© í™•ì¸
lsof -i :8000  # macOS/Linux
netstat -ano | findstr :8000  # Windows

# ë‹¤ë¥¸ í¬íŠ¸ ì‚¬ìš©
uvicorn app.main:app --port 8001
```

### 6.2 ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨

```bash
# ì—°ê²° í…ŒìŠ¤íŠ¸
psql -h localhost -U user -d analyst_awards

# í™˜ê²½ë³€ìˆ˜ í™•ì¸
echo $DATABASE_URL
```

### 6.3 CORS ì˜¤ë¥˜

ë°±ì—”ë“œ `CORS_ORIGINS` í™˜ê²½ë³€ìˆ˜ì— í”„ë¡ íŠ¸ì—”ë“œ ë„ë©”ì¸ ì¶”ê°€:

```bash
CORS_ORIGINS=http://localhost:3000,https://yourdomain.com
```

## 7. ëª¨ë‹ˆí„°ë§

### 7.1 ë¡œê·¸ í™•ì¸

```bash
# Docker Compose ë¡œê·¸
docker-compose logs -f api

# ë°±ì—”ë“œ ë¡œê·¸
tail -f logs/api.log

# Celery ë¡œê·¸
tail -f logs/celery.log
```

### 7.2 í—¬ìŠ¤ ì²´í¬

```bash
# API í—¬ìŠ¤ ì²´í¬
curl http://localhost:8000/api/health

# ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í™•ì¸
curl http://localhost:8000/api/health/db
```

## 8. ë¡¤ë°± ì ˆì°¨

### 8.1 ë§ˆì´ê·¸ë ˆì´ì…˜ ë¡¤ë°±

```bash
cd apps/api
alembic downgrade -1
```

### 8.2 ì½”ë“œ ë¡¤ë°±

```bash
git checkout <previous-commit>
docker-compose restart api
```

## 9. ë³´ì•ˆ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] API í‚¤ê°€ í™˜ê²½ë³€ìˆ˜ë¡œ ê´€ë¦¬ë¨
- [ ] ë°ì´í„°ë² ì´ìŠ¤ ë¹„ë°€ë²ˆí˜¸ ê°•ë ¥í•¨
- [ ] CORS ì„¤ì •ì´ ì ì ˆí•¨
- [ ] HTTPS ì‚¬ìš© (í”„ë¡œë•ì…˜)
- [ ] í™˜ê²½ë³€ìˆ˜ íŒŒì¼ì´ Gitì— ì»¤ë°‹ë˜ì§€ ì•ŠìŒ

