# 리포트 파싱 및 스코어카드 개선 작업 계획

## 현재 상태 분석

### ✅ 구현된 기능

1. **PDF 업로드 기능**
   - `/api/reports/upload` 엔드포인트 구현됨
   - 파일 저장 및 리포트 레코드 생성

2. **문서 추출 서비스**
   - pdfplumber, PyPDF2, PaddleOCR 사용
   - 텍스트, 표, 이미지 추출 기능

3. **데이터베이스 모델**
   - Report, ReportSection, ExtractedText, ExtractedTable, ExtractedImage 완비

4. **스코어카드 모델 및 서비스**
   - 기본 CRUD 기능 구현
   - 랭킹 조회 기능

### ❌ 주요 문제점

1. **Celery/Redis 의존성**
   - `report_service.py:70`에서 `parse_report_task.delay()` 사용
   - Redis 없으면 PDF 파싱 작업이 실행되지 않음

2. **섹션 구조화 미완성**
   - `report_parsing_agent.py:76-83`에서 하드코딩된 빈 응답 반환
   - 실제 섹션 추출 로직 미구현

3. **KPI 점수 하드코딩**
   - `evaluation_agent.py:171-174`에서 일부 KPI가 하드코딩됨
   - risk_analysis_appropriateness, report_frequency, sns_attention, media_frequency

4. **정합성 검증 로직 없음**
   - 애널리스트-기업-섹터 매칭 검증 없음
   - 예측-실제 데이터 기간 일치 검증 없음

5. **최종 점수 계산 로직 미구현**
   - 가중치 정의는 있으나 실제 계산 로직 없음

## 작업 계획

### 우선순위 1: PDF 파싱 작동 가능하게 수정

#### 1.1 Celery/Redis 의존성 제거
- `report_service.py` 수정: Celery 없이 동기적으로 실행 옵션 추가
- Redis 연결 실패 시에도 동작하도록 try-except 처리

#### 1.2 섹션 구조화 개선
- `report_parsing_agent.py` 수정: LLM을 활용한 실제 섹션 추출 구현
- 섹션 타입: summary, analysis, forecast, recommendation, risk, target_price, investment_opinion

#### 1.3 레이아웃 분석 개선
- 헤더/푸터 제거 로직 추가
- 2단 레이아웃 처리
- 차트/그래프 영역 식별 개선

### 우선순위 2: KPI 평가 로직 완성

#### 2.1 하드코딩된 KPI를 실제 계산 로직으로 대체
- risk_analysis_appropriateness: 리포트에서 리스크 분석 섹션 추출 및 평가
- report_frequency: 애널리스트의 리포트 발행 빈도 계산
- sns_attention: SNS 데이터 수집 (향후 구현)
- media_frequency: 미디어 언급 빈도 (향후 구현)

#### 2.2 최종 점수 계산 로직 구현
- 가중치 적용한 최종 점수 계산
- Evaluation 모델에 final_score 저장

### 우선순위 3: 데이터 정합성 검증

#### 3.1 애널리스트-기업-섹터 매칭 검증
- 리포트 업로드 시 애널리스트의 섹터와 기업의 섹터 일치 확인
- 불일치 시 경고 또는 자동 수정

#### 3.2 예측-실제 데이터 기간 일치 검증
- 예측 기간과 실제 결과 기간 일치 확인
- 중복 평가 방지 로직

### 우선순위 4: 프론트엔드 개선

#### 4.1 스코어카드 상세 페이지 개선
- 기간 > 애널리스트 > 리포트 > 평가 데이터 표시
- KPI별 점수 상세 표시
- 리포트 링크 연결

#### 4.2 리포트 업로드 UI 개선
- 업로드 진행 상태 표시
- 추출 결과 미리보기

## 구현 순서

1. ✅ Celery/Redis 의존성 제거
2. ✅ 섹션 구조화 개선
3. ✅ KPI 평가 로직 완성
4. ✅ 정합성 검증 로직 추가
5. ✅ 최종 점수 계산 로직 구현
6. ✅ 프론트엔드 개선

