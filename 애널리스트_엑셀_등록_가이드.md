# 애널리스트 엑셀 파일 등록 가이드

## 문제 상황

`/old_assets/증권사 리서치센터 애널리스트 리스트(반도체 자동차 방산 금융 최종) (1).xlsx` 파일의 데이터가 analysts 페이지에 표시되지 않는 문제가 있었습니다.

## 해결 방법

### 방법 1: 웹 UI를 통한 일괄 등록 (권장)

1. 프론트엔드에서 애널리스트 페이지 접속
2. "일괄 등록" 버튼 클릭
3. Excel 파일 선택
4. 자동으로 데이터베이스에 등록됨

**장점**:
- 사용자 친화적
- 즉시 결과 확인 가능
- 데이터 수집 자동 시작

### 방법 2: Python 스크립트를 통한 등록

```bash
cd apps/api
python scripts/load_analysts_from_excel.py
```

**장점**:
- 대량 데이터 처리에 적합
- 상세한 로그 확인 가능

## 수정 사항

### 1. ExcelParser 컬럼 매핑 개선

엑셀 파일의 실제 컬럼명에 맞게 매핑 추가:

- `'애널리스트 이름'` → `name`
- `'리서치센터'` → `firm`
- `'세부 섹터'` → `department`
- `'담당 산업'` → `sector`

**파일**: `apps/api/app/services/excel_parser.py`

### 2. 프론트엔드 일괄 등록 기능 추가

애널리스트 페이지에 Excel 파일 업로드 기능 추가:

- "일괄 등록" 버튼
- 파일 선택 UI
- 업로드 진행 상황 표시
- 등록 결과 표시

**파일**: `apps/web/src/app/analysts/page.tsx`

## 엑셀 파일 구조

현재 엑셀 파일의 컬럼 구조:

| 컬럼명 | 매핑 필드 | 설명 |
|--------|----------|------|
| 리서치센터 | firm | 증권사명 |
| 담당 산업 | sector | 섹터 (반도체, 자동차, 방산, 금융) |
| 세부 섹터 | department | 부서 |
| 애널리스트 이름 | name | 애널리스트 이름 |

## 사용 방법

### 웹 UI 사용

1. 브라우저에서 `/analysts` 페이지 접속
2. 우측 상단 "일괄 등록" 버튼 클릭
3. Excel 파일 선택 (`.xlsx` 또는 `.xls` 형식)
4. 자동으로 업로드 및 등록 진행
5. 등록 결과 확인

### 스크립트 사용

```bash
# 환경 변수 설정
export DATABASE_URL="postgresql://user:password@localhost:5432/analyst_awards"

# 스크립트 실행
cd apps/api
python scripts/load_analysts_from_excel.py
```

## 예상 결과

엑셀 파일에는 약 65개의 애널리스트 데이터가 있으며, 모두 정상적으로 등록되어야 합니다.

등록 후:
- `/analysts` 페이지에서 목록 확인 가능
- 각 애널리스트의 상세 정보 확인 가능
- 데이터 수집이 자동으로 시작됨

## 문제 해결

### 데이터가 보이지 않는 경우

1. **데이터베이스 연결 확인**
   ```bash
   # PostgreSQL 서비스 실행 확인
   brew services list | grep postgresql
   # 또는
   docker-compose ps
   ```

2. **마이그레이션 확인**
   ```bash
   cd apps/api
   alembic current
   alembic upgrade head
   ```

3. **등록 여부 확인**
   ```bash
   # 데이터베이스에서 직접 확인
   psql -U user -d analyst_awards -c "SELECT COUNT(*) FROM analysts;"
   ```

### 업로드 실패 시

1. **파일 형식 확인**: `.xlsx` 또는 `.xls` 형식인지 확인
2. **컬럼명 확인**: 엑셀 파일의 첫 번째 행이 헤더인지 확인
3. **백엔드 로그 확인**: 에러 메시지 확인

## 다음 단계

데이터 등록 후:
1. ✅ 애널리스트 목록 확인
2. ✅ 각 애널리스트 상세 정보 확인
3. ✅ 데이터 수집 작업 확인 (자동 시작됨)
4. ✅ 리포트 업로드 및 평가 진행

